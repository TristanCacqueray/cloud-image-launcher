#cloud-config
hostname: {{ hostname }}
fqdn: {{ hostname }}.{{ domain }}

{% if distribution == 'centos' %}
groups:
  - centos
{% endif %}
users:
  - default
  - name: root
    ssh-authorized-keys:
      - {{ pub_key }}
{% if distribution == 'centos' %}
  - name: centos
    gecos: RedHat Openstack User
    shell: /bin/bash
    primary-group: centos
{% endif %}
{% if distribution == 'fedora' %}
  - name: fedora
    gecos: Fedora User
    shell: /bin/bash
    primary-group: fedora
{% endif %}
    ssh-authorized-keys:
      - {{ pub_key }}
    sudo:
      - ALL=(ALL) NOPASSWD:ALL

write_files:
  - path: /etc/sysconfig/network
    content: |
      NETWORKING=yes
      NOZEROCONF=no
      HOSTNAME={{ hostname }}
  - path: /etc/sysctl.conf
    content: |
      net.ipv4.ip_forward = 1
  - path: /etc/sysconfig/network-scripts/ifcfg-eth0
    content: |
      DEVICE='eth0'
      ONBOOT='yes'
      TYPE='Ethernet'
      BOOTPROTO='dhcp'

runcmd:
  - /usr/sbin/sysctl -p
  - /usr/bin/sed  -i 's/\(127.0.0.1\)[[:space:]]*\(localhost.*\)/\1 {{ hostname }}.{{ domain }} {{ hostname }} \2/' /etc/hosts
  - /usr/bin/systemctl restart network
  - /usr/bin/sed  -i 's/requiretty/\!requiretty/' /etc/sudoers
